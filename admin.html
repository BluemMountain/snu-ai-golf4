<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëª¨ë“œ - 2026 SNU AI CEO 4ê¸° ê³¨í”„íšŒ</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            padding-top: 40px;
            padding-bottom: 80px;
        }

        .admin-page-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #577b2d;
            padding-bottom: 20px;
        }

        .admin-header h1 {
            color: #1e3a2b;
            margin: 0;
            font-size: 2rem;
        }

        .back-home {
            text-decoration: none;
            color: #666;
            font-weight: 500;
            font-size: 0.9rem;
            transition: color 0.3s;
        }

        .back-home:hover {
            color: #577b2d;
        }

        /* Re-style tabs for the page */
        .admin-tabs {
            margin-bottom: 30px;
        }

        .table-container-wrapper {
            box-shadow: none;
            border: 1px solid #eee;
            padding: 0;
        }

        #admin-table th,
        #admin-member-table th {
            white-space: nowrap;
        }

        /* Auth Overlay if not logged in */
        #admin-auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Simple Auth Overlay -->
    <div id="admin-auth-overlay">
        <h2 style="font-family: 'Noto Serif KR', serif; color: #1e3a2b; margin-bottom: 20px;">ê´€ë¦¬ì ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
        <button onclick="requestAdminAuth()" class="cta-button">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</button>
        <a href="index.html" class="back-home" style="margin-top: 20px; display: block;">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>

    <div class="container">
        <div class="admin-page-container">
            <div class="admin-header">
                <div>
                    <a href="index.html" class="back-home">â† ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
                    <h1>ê´€ë¦¬ì ëª¨ë“œ</h1>
                </div>
                <div id="admin-global-buttons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button id="admin-refresh-btn" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem;">ìƒˆë¡œê³ ì¹¨</button>
                    <button id="admin-download-btn" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem; background-color: #2980b9;">ìŠ¤ì½”ì–´ ë‹¤ìš´</button>
                    <button id="admin-clear-btn" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem; background-color: #e74c3c;">ì´ˆê¸°í™”</button>
                    <button id="admin-export-btn" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem; background-color: #27ae60;">ë°±ì—…</button>
                    <button id="admin-import-trigger" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem; background-color: #f39c12;">ë³µì›</button>
                    <button id="bulk-exec-btn" class="cta-button"
                        style="padding: 8px 15px; font-size: 0.85rem; background-color: #3498db;">ì„ì›ì§„ ë“±ë¡</button>
                    <input type="file" id="import-file" style="display: none;">
                </div>
            </div>

            <div class="admin-tabs">
                <button class="tab-btn active" data-tab="tab-rsvps">ì°¸ì„ í˜„í™©</button>
                <button class="tab-btn" data-tab="tab-members">íšŒì› ê´€ë¦¬</button>
                <button class="tab-btn" data-tab="tab-groups">ì¡°í¸ì„±</button>
            </div>

            <!-- Tab 1: RSVPs -->
            <div id="tab-rsvps" class="tab-content active">
                <div class="table-container-wrapper">
                    <div style="overflow-x: auto;">
                        <table id="admin-table" style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
                            <thead>
                                <tr style="background-color: #f4f4f4;">
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì¼ì‹œ</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì„±í•¨</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì—°ë½ì²˜</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ìƒíƒœ</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ìŠ¤í°</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ìŠ¤ì½”ì–´</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ìˆ˜ìƒ</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">25ë…„ í•¸ë””</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì „ì›” ìŠ¤ì½”ì–´</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">26ë…„ í•¸ë”” (í‰ê· )
                                    </th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ì‹ ì²­ ì‹œê°</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div style="margin-top: 50px; border-top: 2px solid #577b2d; padding-top: 30px; text-align: center;">
                    <h4 style="margin-top: 0; color: #1e3a2b; font-size: 1.2rem;">ğŸ“Š ìƒì„¸ ìŠ¤ì½”ì–´ ê¸°ë¡ ê´€ë¦¬</h4>
                    <p style="color: #666; margin-bottom: 20px;">ê³¼ê±° ë¼ìš´ë“œì˜ ìƒì„¸ ê¸°ë¡ í™•ì¸ ë° ì‹ ê·œ ë¼ìš´ë“œ ê²°ê³¼ì…ë ¥ ì „ìš© í˜ì´ì§€ì…ë‹ˆë‹¤.</p>
                    <a href="admin_records.html" class="cta-button"
                        style="padding: 12px 30px; font-size: 1rem; background-color: #577b2d; text-decoration: none; color: #fff;">ìƒì„¸
                        ìŠ¤ì½”ì–´ ê´€ë¦¬ í˜ì´ì§€ ì´ë™ â†’</a>
                </div>
            </div>

            <!-- Tab 2: Members -->
            <div id="tab-members" class="tab-content">
                <div class="add-member-form"
                    style="background: #f9f9f9; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #eee;">
                    <h4 style="margin-top: 0; color: #1e3a2b;">â• íšŒì› ì¶”ê°€</h4>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center; margin-top: 15px;">
                        <input type="text" id="new-member-name" placeholder="ì´ë¦„ (ì˜ˆ: í™ê¸¸ë™)"
                            style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; flex: 1; min-width: 150px;">
                        <select id="new-member-type"
                            style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; min-width: 120px;">
                            <option value="jeong">ì •íšŒì›</option>
                            <option value="jun">ì¤€íšŒì›</option>
                            <option value="ilban">ì¼ë°˜íšŒì›</option>
                            <option value="special">íŠ¹ë³„íšŒì›</option>
                            <option value="executive">ì„ì›</option>
                        </select>
                        <input type="text" id="new-member-role" placeholder="ì§ì±… (ì˜ˆ: íšŒì¥)"
                            style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; display: none; flex: 1; min-width: 150px;">
                        <button id="add-member-btn" class="cta-button" style="padding: 10px 25px;">ì¶”ê°€í•˜ê¸°</button>
                    </div>
                </div>

                <div class="table-container-wrapper">
                    <div style="overflow-x: auto;">
                        <table id="admin-member-table"
                            style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
                            <thead>
                                <tr style="background-color: #f4f4f4;">
                                    <th style="padding: 15px; border: 1px solid #ddd; text-align: left;">ì´ë¦„</th>
                                    <th style="padding: 15px; border: 1px solid #ddd; text-align: left;">êµ¬ë¶„</th>
                                    <th style="padding: 15px; border: 1px solid #ddd; text-align: left;">ìˆ˜ìƒ ë‚´ì—­</th>
                                    <th style="padding: 15px; border: 1px solid #ddd; text-align: center;">ê´€ë¦¬</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Member list loaded via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Group Assignment -->
            <div id="tab-groups" class="tab-content">
                <div class="action-bar"
                    style="background: #fdfaf4; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #f0e6d2;">
                    <h4 style="margin-top: 0; color: #1e3a2b;">ğŸ² ìë™ ì¡°í¸ì„± ì‹œìŠ¤í…œ</h4>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">ì „ì²´ íšŒì› ëª©ë¡ ë˜ëŠ” í˜„ì¬ ë¼ìš´ë“œ ì‹ ì²­ìë¥¼ ëŒ€ìƒìœ¼ë¡œ ëœë¤ ì¡°í¸ì„±ì„
                        ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="cta-button" onclick="assignGroups('sample')"
                            style="background-color: #577b2d; padding: 10px 20px;">ì „ì²´ íšŒì› ìƒ˜í”Œ ì¡°í¸ì„±</button>
                        <button class="cta-button" onclick="assignGroups('rsvp')"
                            style="background-color: #2980b9; padding: 10px 20px;">í˜„ì¬ ì‹ ì²­ì ê¸°ë°˜ ì¡°í¸ì„±</button>
                        <button class="cta-button" id="copy-groups-btn"
                            style="background-color: #888; padding: 10px 20px;">ê²°ê³¼ ë³µì‚¬í•˜ê¸°</button>
                    </div>
                </div>
                <div id="group-assignment-result"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                    <div
                        style="grid-column: 1/-1; text-align: center; color: #aaa; padding: 60px; border: 2px dashed #eee; border-radius: 12px;">
                        <i class="fa-solid fa-users-viewfinder"
                            style="font-size: 3rem; margin-bottom: 20px; color: #eee;"></i>
                        <p>ìƒë‹¨ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¡°í¸ì„±ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aggressive Cache Clearing & SW Deregistration (Same as index) -->
    <script>
        async function clearAllCaches() {
            try {
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    for (let registration of registrations) { await registration.unregister(); }
                }
                if ('caches' in window) {
                    const cacheNames = await caches.keys();
                    for (let name of cacheNames) { await caches.delete(name); }
                }
            } catch (err) { console.error('Cache clearing failed:', err); }
        }
        clearAllCaches();
    </script>

    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js?v=1.6"></script>

    <script>
        // Inline Auth Logic for Admin Page
        function requestAdminAuth() {
            const password = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
            if (!password) return;

            // Same hash as in script.js
            const targetHash = '07e47f77d22e2fc388c2d12f73b8b8b7e9928630d39a4964a9daabbc27a060f4';

            async function check() {
                const msgBuffer = new TextEncoder().encode(password);
                const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                const inputHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

                if (inputHash === targetHash) {
                    sessionStorage.setItem('snu_golf_admin_logged_in', 'true');
                    document.getElementById('admin-auth-overlay').style.display = 'none';
                    // Trigger data load
                    if (typeof loadAdminData === 'function') loadAdminData();
                    if (typeof loadAdminMembers === 'function') loadAdminMembers();
                } else {
                    alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
                }
            }
            check();
        }

        // Check auth on load
        window.addEventListener('DOMContentLoaded', () => {
            if (sessionStorage.getItem('snu_golf_admin_logged_in') === 'true') {
                document.getElementById('admin-auth-overlay').style.display = 'none';
                // Wait for script.js to load functions
                setTimeout(() => {
                    if (typeof loadAdminData === 'function') loadAdminData();
                    if (typeof loadAdminMembers === 'function') loadAdminMembers();
                }, 500);
            }
        });

        // Setup triggers for global buttons (since script.js looks for them)
        document.getElementById('admin-export-btn').onclick = () => { if (typeof exportData === 'function') exportData(); };
        document.getElementById('admin-import-trigger').onclick = () => { document.getElementById('import-file').click(); };
        document.getElementById('import-file').onchange = (e) => { if (typeof importData === 'function') importData(e); };
    </script>
</body>

</html>